<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Kişiye Özel QR Sayfası</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f4f4f4;
      text-align: center;
    }
    #qrcode {
      margin: 20px auto;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

  <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full">
    <h1 class="text-2xl font-bold text-gray-800 mb-4">📌 Kişiye Özel QR Kod</h1>
    <div id="qrcode" class="mb-4"></div>
    <p id="qrText" class="text-lg font-semibold text-gray-700"></p>
    <div id="thankYou" class="text-center bg-gray-900 p-8 rounded-lg shadow-md mt-6"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZxHq28my4VLR-xX94wvkr6Gf-ohyeH98",
      authDomain: "e-y-yonetici.firebaseapp.com",
      projectId: "e-y-yonetici"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    async function fetchData() {
      if (!id) {
        document.getElementById("qrText").textContent = "❌ ID eksik.";
        return;
      }

      try {
        const docRef = doc(db, "pending_reservations", id); // Firestore yolu düzeltildi
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();

          new QRCode(document.getElementById("qrcode"), {
            text: data.qrCodeContent,
            width: 128,
            height: 128
          });

          document.getElementById("qrText").textContent = data.qrCodeDisplayText || "";
          
          if (data.thankYouMessage) {
            document.getElementById("thankYou").innerHTML = `
              <h3 class="text-2xl font-bold text-white mb-4">BİZİ TERCİH ETTİĞİNİZ İÇİN TEŞEKKÜR EDERİZ!</h3>
              <p class="text-base font-semibold text-gray-200 leading-relaxed uppercase">
                ${data.thankYouMessage}
              </p>
            `;
          }

        } else {
          document.getElementById("qrText").textContent = "❌ Veri bulunamadı.";
        }
      } catch (error) {
        document.getElementById("qrText").textContent = "❌ Veri çekerken bir hata oluştu.";
        console.error("Hata:", error);
      }
    }

    fetchData();
  </script>
</body>
</html>
