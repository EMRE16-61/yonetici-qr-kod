<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetici Paneli</title>
    <!-- Tailwind CSS kütüphanesi -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-lg shadow-xl max-w-4xl w-full">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Yönetici Paneli</h1>

        <!-- Rezervasyon Ekleme Formu -->
        <div class="space-y-4 mb-8">
            <h2 class="text-xl font-semibold text-gray-800">Yeni Rezervasyon Ekle</h2>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" id="customerName" placeholder="Müşteri Adı Soyadı" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                <select id="eventType" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                    <option value="dugun">Düğün Çekimi</option>
                    <option value="nisan">Nişan Çekimi</option>
                    <option value="dis_cekim">Dış Çekim</option>
                </select>
                <button id="addReservationBtn" class="bg-green-600 text-white rounded-md shadow-sm px-4 py-2 hover:bg-green-700 transition-colors">
                    Rezervasyon Ekle
                </button>
            </div>
            <div id="statusMessage" class="mt-2 text-sm font-medium hidden"></div>
        </div>

        <!-- Rezervasyon Listesi -->
        <div id="reservationsListContainer">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Mevcut Rezervasyonlar</h2>
            <div id="reservationsList" class="space-y-4">
                <!-- Rezervasyonlar buraya dinamik olarak eklenecek -->
            </div>
        </div>
    </div>

    <!-- Firebase kütüphaneleri -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase yapılandırma objenizi buraya yapıştırın.
        const firebaseConfig = {
            apiKey: "AIzaSyAZxHq28my4VLR-xX94wvkr6Gf-ohyeH98",
            authDomain: "e-y-yonetici.firebaseapp.com",
            databaseURL: "https://e-y-yonetici-default-rtdb.firebaseio.com",
            projectId: "e-y-yonetici",
            storageBucket: "e-y-yonetici.firebasestorage.app",
            messagingSenderId: "954162170596",
            appId: "1:954162170596:web:f93d6ea49747ad67dafaf1",
            measurementId: "G-8CBJM61ZTW"
        };
        
        // Firebase uygulamasını başlat
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // HTML elemanlarını seç
        const customerNameEl = document.getElementById('customerName');
        const eventTypeEl = document.getElementById('eventType');
        const addReservationBtn = document.getElementById('addReservationBtn');
        const reservationsListEl = document.getElementById('reservationsList');
        const statusMessageEl = document.getElementById('statusMessage');

        // Firestore'a yeni rezervasyon ekleme işlevi
        const addReservation = async () => {
            const name = customerNameEl.value.trim();
            const type = eventTypeEl.value;

            if (!name) {
                statusMessageEl.textContent = 'Lütfen müşteri adı girin.';
                statusMessageEl.classList.remove('hidden');
                statusMessageEl.classList.remove('text-green-600');
                statusMessageEl.classList.add('text-red-600');
                return;
            }

            try {
                // 'reservations' koleksiyonuna yeni belge ekle
                await addDoc(collection(db, "reservations"), {
                    name: name,
                    eventType: type,
                    timestamp: new Date()
                });
                customerNameEl.value = ''; // Giriş alanını temizle
                statusMessageEl.textContent = 'Rezervasyon başarıyla eklendi!';
                statusMessageEl.classList.remove('hidden');
                statusMessageEl.classList.remove('text-red-600');
                statusMessageEl.classList.add('text-green-600');
            } catch (e) {
                console.error("Rezervasyon eklenirken hata oluştu: ", e);
                statusMessageEl.textContent = 'Hata oluştu: Rezervasyon eklenemedi.';
                statusMessageEl.classList.remove('hidden');
                statusMessageEl.classList.remove('text-green-600');
                statusMessageEl.classList.add('text-red-600');
            }
        };

        // Firestore'daki rezervasyonları dinleme ve listeleme işlevi
        const listenForReservations = () => {
            onSnapshot(collection(db, "reservations"), (querySnapshot) => {
                reservationsListEl.innerHTML = ''; // Listeyi temizle
                querySnapshot.forEach((doc) => {
                    const reservation = doc.data();
                    const reservationId = doc.id;
                    const reservationItem = document.createElement('div');
                    
                    // Rezervasyon türüne göre metin ve sayfa adı
                    let qrKodText = '';
                    let qrLink = '';
                    if (reservation.eventType === 'dugun') {
                        qrKodText = 'Düğün Çekimi İçin QR Kodu';
                        qrLink = `https://emre16-61.github.io/yonetici-qr-kod/musteri_sayfasi.html?type=dugun&id=${reservationId}`;
                    } else if (reservation.eventType === 'nisan' || reservation.eventType === 'dis_cekim') { // nisan ve dis_cekim için aynı sayfa
                        qrKodText = 'Nişan / Dış Çekim İçin QR Kodu';
                        qrLink = `https://emre16-61.github.io/yonetici-qr-kod/musteri_sayfasi.html?type=nisan_dis_cekim&id=${reservationId}`;
                    }
                    
                    reservationItem.innerHTML = `
                        <div class="flex justify-between items-center bg-gray-50 p-4 rounded-md shadow-sm">
                            <span class="text-gray-800 font-medium">${reservation.name} (${reservation.eventType.toUpperCase()})</span>
                            <a href="${qrLink}" target="_blank" class="bg-indigo-600 text-white rounded-md shadow-sm px-4 py-2 hover:bg-indigo-700 transition-colors text-sm">
                                QR Kodu Görüntüle
                            </a>
                        </div>
                    `;
                    reservationsListEl.appendChild(reservationItem);
                });
            });
        };

        // Butona olay dinleyicisi ekle
        addReservationBtn.addEventListener('click', addReservation);

        // Sayfa yüklendiğinde verileri dinlemeye başla
        document.addEventListener('DOMContentLoaded', listenForReservations);
    </script>
</body>
</html>
